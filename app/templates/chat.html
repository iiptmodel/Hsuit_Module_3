<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediScan</title>
    <link rel="stylesheet" href="/static/css/chat.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Dashboard Stats Panel -->
    <div class="dashboard-panel">
        <div class="dashboard-header">
            <div class="logo-section">
                    <div class="logo-icon" aria-hidden="true">
                        <!-- simple professional mark -->
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <rect x="3" y="4" width="18" height="16" rx="3" fill="#1f4b66" />
                            <path d="M8 10h8M12 7v10" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                <div class="logo-text">
                    <h1>MediScan AI</h1>
                    <p class="tagline">Intelligent Medical Analysis with Guardrails</p>
                </div>
                    <div style="position: absolute; top: 0.6rem; right: 1rem;">
                        <button id="themeToggleBtn" class="btn-icon" title="Toggle theme" aria-label="Toggle theme" aria-pressed="false">
                            <!-- Sun icon (light mode) -->
                            <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 3v2M12 19v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4M12 7a5 5 0 100 10 5 5 0 000-10z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <!-- Moon icon (dark mode) -->
                            <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon"><span class="stat-dot" aria-hidden="true"></span></div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-reports">0</div>
                        <div class="stat-label">Reports</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><span class="stat-dot" aria-hidden="true"></span></div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-chats">0</div>
                        <div class="stat-label">Chats</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><span class="stat-dot" aria-hidden="true"></span></div>
                    <div class="stat-content">
                        <div class="stat-value">MedGemma</div>
                        <div class="stat-label">AI Model</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><span class="stat-dot" aria-hidden="true"></span></div>
                    <div class="stat-content">
                        <div class="stat-value">Protected</div>
                        <div class="stat-label">Guardrails Active</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-container">
        <!-- Sidebar -->
        <div class="chat-sidebar">
            <div class="sidebar-header">
                <h2>Chat Sessions</h2>
                <button class="btn-new-session" id="newSessionBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    New Chat
                </button>
            </div>
            <div class="session-list" id="sessionList">
                <!-- Sessions will be loaded here -->
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-main">
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-content">
                    <div class="welcome-icon" aria-hidden="true">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="4" width="18" height="16" rx="3" fill="#1f4b66" />
                            <path d="M8 10h8M12 7v10" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h2>Welcome to MediScan</h2>
                    <p class="muted">Upload a medical document to get a concise, safe summary or a clinician-facing report.</p>
                    
                    <div class="feature-cards">
                        <div class="feature-card">
                            <h3>Document & Image Analysis</h3>
                            <p class="muted">Upload reports or images for concise patient summaries or clinician reports.</p>
                        </div>
                        <div class="feature-card">
                            <h3>Interactive Chat</h3>
                            <p class="muted">Ask focused questions and get safe, explainable answers.</p>
                        </div>
                    </div>

                    <div class="quick-start">
                        <h3>Get Started</h3>
                        <p>Create a new chat session or upload a medical document to begin</p>
                        <button class="btn-primary" id="quickStartBtn">Start New Session</button>
                    </div>
                </div>
            </div>

            <!-- Chat Screen -->
            <div class="chat-screen" id="chatScreen" style="display: none;">
                <div class="chat-header">
                    <div class="session-info">
                        <div style="display:flex; align-items:center; gap:8px;">
                            <h2 id="sessionTitle">Medical Analysis Chat</h2>
                            <button id="renameChatBtn" class="btn-icon" title="Rename chat" aria-label="Rename chat">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" stroke="currentColor" stroke-width="0" fill="currentColor"/></svg>
                            </button>
                        </div>
                        <span class="session-status">‚óè Active</span>
                    </div>
                    <div class="chat-actions">
                        <button class="btn-icon" id="clearChatBtn" title="Clear Chat">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M19 7L18.1327 19.1425C18.0579 20.1891 17.187 21 16.1378 21H7.86224C6.81296 21 5.94208 20.1891 5.86732 19.1425L5 7M10 11V17M14 11V17M15 7V4C15 3.44772 14.5523 3 14 3H10C9.44772 3 9 3.44772 9 4V7M4 7H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="btn-icon" id="filesToggleBtn" title="Files" aria-label="Toggle files panel">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 2h8l4 4v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <!-- Messages will be loaded here -->
                </div>

                <!-- File Upload Area -->
                <div class="file-upload-area" id="fileUploadArea">
                    <div class="uploaded-files" id="uploadedFiles" style="display: none;">
                        <!-- Uploaded files preview will appear here -->
                    </div>
                    <div class="reports-list" id="reportsList" style="display: none; padding: 0.75rem;">
                        <!-- Session reports (uploaded files) will be listed here -->
                    </div>
                </div>

                <!-- Input Area -->
                <div class="input-area">
                    <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg,.bmp,.tiff,.gif,.wav,.mp3,.ogg,.webm" style="display: none;" aria-label="Attach a file">
                    <button class="btn-attach" id="attachBtn" title="Attach File">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M21.4 7.5C21.4 6.1 20.3 5 18.9 5H5.1C3.7 5 2.6 6.1 2.6 7.5V16.5C2.6 17.9 3.7 19 5.1 19H18.9C20.3 19 21.4 17.9 21.4 16.5V7.5Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M7 9L12 13L17 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div id="fileChip" class="file-chip" aria-live="polite" style="display:none;" title="Attached file">
                        <span class="file-chip-icon">üìé</span>
                        <span class="file-chip-name" id="fileChipName"></span>
                        <button class="btn-remove-file" id="fileChipRemove" aria-label="Remove attached file" title="Remove attached file">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        </button>
                    </div>
                    <div class="audience-select">
                        <label for="audienceSelect" class="visually-hidden">Audience</label>
                        <select id="audienceSelect" title="Send as:" aria-label="Audience">
                            <option value="patient" selected>Patient</option>
                            <option value="doctor">Doctor</option>
                        </select>
                    </div>
                    <div class="input-wrapper">
                        <textarea 
                            id="messageInput" 
                            placeholder="Type your message or question here... (You can also attach files)"
                            rows="1"
                        ></textarea>
                    </div>
                    <button class="btn-send" id="sendBtn" disabled>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/chat.js"></script>
    <!-- Files panel (drawer) -->
    <div id="filesPanel" class="files-panel" aria-hidden="true">
        <div class="files-panel-header">
            <h3 style="margin:0;">Uploaded Files</h3>
            <button id="filesPanelClose" class="btn-icon" title="Close files panel" aria-label="Close files panel" style="margin-left:8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
        <div id="filesPanelContent" class="files-panel-content"></div>
    </div>
    <!-- Accessibility live region -->
    <div id="a11yLive" aria-live="polite" aria-atomic="true" style="position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden;"></div>
</body>
</html>
