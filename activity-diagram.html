<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Report Analysis System - Activity Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 1600px;
            width: 100%;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.2em;
            font-weight: 300;
        }

        .diagram-container {
            width: 100%;
            overflow-x: auto;
            background: #fafbfc;
            border-radius: 15px;
            padding: 30px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .mermaid {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .code-section {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            overflow-x: auto;
        }

        .code-section h4 {
            color: #94a3b8;
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .code-section pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .subtitle {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ Medical Report Analysis System</h1>
        <p class="subtitle">Activity Diagram - System Activities and Workflows</p>
        
        <div class="diagram-container">
            <div class="mermaid">
graph TD
    %% Start
    Start([ğŸš€ Start System]) --> Login
    
    %% User Swimlane
    subgraph "ğŸ‘¤ User Activities"
        Login[ğŸ” Login/Authenticate]
        UploadFile[ğŸ“ Upload Medical Document<br/>PDF/PNG/JPG/BMP/TIFF]
        EnterChat[ğŸ’¬ Enter Chat Message<br/>or Query]
        RequestVoice[ğŸ”Š Request Voice Output]
        RequestReport[ğŸ“‹ Request Detailed Report]
        ManageSession[âš™ï¸ Manage Sessions<br/>Create/Switch/Delete]
        Logout[ğŸšª Logout]
    end
    
    %% System Swimlane
    subgraph "ğŸ¤– System Activities"
        ValidateFile[âœ… Validate File Type<br/>and Format]
        ParseDocument[ğŸ” Parse Document<br/>Docling â†’ Sanitize â†’ OCR]
        CheckSafety[ğŸ›¡ï¸ Check Query Safety<br/>Guardrails]
        AnalyzeContent[ğŸ§  Analyze Content<br/>MedGemma AI Model]
        GenerateSummary[ğŸ“ Generate Medical Summary<br/>Safe & Educational]
        ConvertSpeech[ğŸ”Š Convert to Speech<br/>Kokoro TTS Engine]
        CreateReport[ğŸ“‹ Create Detailed Report<br/>Structured Data]
        StoreData[ğŸ’¾ Store Results<br/>Database]
        SendResponse[ğŸ“¤ Send Response<br/>to User]
    end
    
    %% Decision Points
    FileValid{File<br/>Valid?}
    ParseSuccess{Parse<br/>Success?}
    QuerySafe{Query<br/>Safe?}
    AnalysisSuccess{Analysis<br/>Success?}
    OutputType{Output<br/>Type}
    
    %% Flow Connections
    Login --> UploadFile
    Login --> EnterChat
    
    UploadFile --> ValidateFile
    ValidateFile -->|No| ErrorFile[âŒ Invalid File<br/>Show Error]
    ErrorFile --> UploadFile
    
    ValidateFile -->|Yes| ParseDocument
    ParseDocument --> ParseSuccess
    ParseSuccess -->|No| RetryParse[ğŸ”„ Retry Parsing<br/>Alternative Method]
    RetryParse --> ParseDocument
    
    ParseSuccess -->|Yes| AnalyzeContent
    
    EnterChat --> CheckSafety
    CheckSafety --> QuerySafe
    QuerySafe -->|No| RejectQuery[ğŸš« Reject Unsafe Query<br/>Safety Violation]
    RejectQuery --> EnterChat
    
    QuerySafe -->|Yes| AnalyzeContent
    
    AnalyzeContent --> AnalysisSuccess
    AnalysisSuccess -->|No| ErrorAnalysis[âŒ Analysis Failed<br/>Show Error]
    ErrorAnalysis --> UploadFile
    ErrorAnalysis --> EnterChat
    
    AnalysisSuccess -->|Yes| GenerateSummary
    GenerateSummary --> StoreData
    StoreData --> OutputType
    
    OutputType -->|Text Response| SendResponse
    SendResponse --> EnterChat
    SendResponse --> RequestVoice
    SendResponse --> RequestReport
    
    OutputType -->|Voice Output| ConvertSpeech
    ConvertSpeech --> SendResponse
    
    OutputType -->|Report| CreateReport
    CreateReport --> SendResponse
    
    RequestVoice --> ConvertSpeech
    RequestReport --> CreateReport
    
    Login --> ManageSession
    ManageSession --> UploadFile
    ManageSession --> EnterChat
    
    SendResponse --> Logout
    Logout --> End([ğŸ End Session])
    
    %% Styling
    classDef userActivity fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef systemActivity fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef startend fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    
    class Start,End startend
    class Login,UploadFile,EnterChat,RequestVoice,RequestReport,ManageSession,Logout userActivity
    class ValidateFile,ParseDocument,CheckSafety,AnalyzeContent,GenerateSummary,ConvertSpeech,CreateReport,StoreData,SendResponse systemActivity
    class FileValid,ParseSuccess,QuerySafe,AnalysisSuccess,OutputType decision
    class ErrorFile,RejectQuery,ErrorAnalysis error
            </div>
        </div>
        
        <div class="code-section">
            <h4>ğŸ“‹ Mermaid Code - Copy & Paste</h4>
            <pre><code>graph TD
    %% Start
    Start([ğŸš€ Start System]) --&gt; Login
    
    %% User Swimlane
    subgraph "ğŸ‘¤ User Activities"
        Login[ğŸ” Login/Authenticate]
        UploadFile[ğŸ“ Upload Medical Document&lt;br/&gt;PDF/PNG/JPG/BMP/TIFF]
        EnterChat[ğŸ’¬ Enter Chat Message&lt;br/&gt;or Query]
        RequestVoice[ğŸ”Š Request Voice Output]
        RequestReport[ğŸ“‹ Request Detailed Report]
        ManageSession[âš™ï¸ Manage Sessions&lt;br/&gt;Create/Switch/Delete]
        Logout[ğŸšª Logout]
    end
    
    %% System Swimlane
    subgraph "ğŸ¤– System Activities"
        ValidateFile[âœ… Validate File Type&lt;br/&gt;and Format]
        ParseDocument[ğŸ” Parse Document&lt;br/&gt;Docling â†’ Sanitize â†’ OCR]
        CheckSafety[ğŸ›¡ï¸ Check Query Safety&lt;br/&gt;Guardrails]
        AnalyzeContent[ğŸ§  Analyze Content&lt;br/&gt;MedGemma AI Model]
        GenerateSummary[ğŸ“ Generate Medical Summary&lt;br/&gt;Safe & Educational]
        ConvertSpeech[ğŸ”Š Convert to Speech&lt;br/&gt;Kokoro TTS Engine]
        CreateReport[ğŸ“‹ Create Detailed Report&lt;br/&gt;Structured Data]
        StoreData[ğŸ’¾ Store Results&lt;br/&gt;Database]
        SendResponse[ğŸ“¤ Send Response&lt;br/&gt;to User]
    end
    
    %% Decision Points
    FileValid{File&lt;br/&gt;Valid?}
    ParseSuccess{Parse&lt;br/&gt;Success?}
    QuerySafe{Query&lt;br/&gt;Safe?}
    AnalysisSuccess{Analysis&lt;br/&gt;Success?}
    OutputType{Output&lt;br/&gt;Type}
    
    %% Flow Connections
    Login --&gt; UploadFile
    Login --&gt; EnterChat
    
    UploadFile --&gt; ValidateFile
    ValidateFile --&gt;|No| ErrorFile[âŒ Invalid File&lt;br/&gt;Show Error]
    ErrorFile --&gt; UploadFile
    
    ValidateFile --&gt;|Yes| ParseDocument
    ParseDocument --&gt; ParseSuccess
    ParseSuccess --&gt;|No| RetryParse[ğŸ”„ Retry Parsing&lt;br/&gt;Alternative Method]
    RetryParse --&gt; ParseDocument
    
    ParseSuccess --&gt;|Yes| AnalyzeContent
    
    EnterChat --&gt; CheckSafety
    CheckSafety --&gt; QuerySafe
    QuerySafe --&gt;|No| RejectQuery[ğŸš« Reject Unsafe Query&lt;br/&gt;Safety Violation]
    RejectQuery --&gt; EnterChat
    
    QuerySafe --&gt;|Yes| AnalyzeContent
    
    AnalyzeContent --&gt; AnalysisSuccess
    AnalysisSuccess --&gt;|No| ErrorAnalysis[âŒ Analysis Failed&lt;br/&gt;Show Error]
    ErrorAnalysis --&gt; UploadFile
    ErrorAnalysis --&gt; EnterChat
    
    AnalysisSuccess --&gt;|Yes| GenerateSummary
    GenerateSummary --&gt; StoreData
    StoreData --&gt; OutputType
    
    OutputType --&gt;|Text Response| SendResponse
    SendResponse --&gt; EnterChat
    SendResponse --&gt; RequestVoice
    SendResponse --&gt; RequestReport
    
    OutputType --&gt;|Voice Output| ConvertSpeech
    ConvertSpeech --&gt; SendResponse
    
    OutputType --&gt;|Report| CreateReport
    CreateReport --&gt; SendResponse
    
    RequestVoice --&gt; ConvertSpeech
    RequestReport --&gt; CreateReport
    
    Login --&gt; ManageSession
    ManageSession --&gt; UploadFile
    ManageSession --&gt; EnterChat
    
    SendResponse --&gt; Logout
    Logout --&gt; End([ğŸ End Session])
    
    %% Styling
    classDef userActivity fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef systemActivity fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef startend fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    
    class Start,End startend
    class Login,UploadFile,EnterChat,RequestVoice,RequestReport,ManageSession,Logout userActivity
    class ValidateFile,ParseDocument,CheckSafety,AnalyzeContent,GenerateSummary,ConvertSpeech,CreateReport,StoreData,SendResponse systemActivity
    class FileValid,ParseSuccess,QuerySafe,AnalysisSuccess,OutputType decision
    class ErrorFile,RejectQuery,ErrorAnalysis error</code></pre>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>